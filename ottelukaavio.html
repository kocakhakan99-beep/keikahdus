<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Keikahdusliiga – Debug View</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Press+Start+2P|Orbitron:700,900" rel="stylesheet">
<style>
/* ---------- CORE VISUAL VARS YOU CAN TWEAK ---------- */
:root {
  --vh-grid-size: 210px;
  --cup-size: 42px;
  --table-scale: 0.9;
  --grid-offset-y: 0px;
  --vh-area-scale: 0.85; /* 0.7–1.0 useful */
  --debug-outline: 0 0 0 2px #ffb700, 0 0 12px #ffb700;
}
html,body { margin:0; padding:0; font-family:'Press Start 2P','Orbitron',Arial,sans-serif; background:#0d0d17; color:#fff; }

/* Basic reused styles (trimmed for brevity) */
h1,h2 { color:#ff00c8; text-shadow:0 0 8px #ff00c8; margin:0 0 12px; }
.section { background:linear-gradient(135deg,#2b0057 50%,#1e1e2a 100%); padding:1.1em 1.6em; margin:1em 0; border-radius:14px; box-shadow:0 4px 24px #b200ff66; }
.btn {
  background:linear-gradient(90deg,#00ffd0,#ff00c8);
  color:#111; font-weight:bold; border:none; border-radius:9px;
  padding:10px 18px; cursor:pointer; font-family:'Orbitron',sans-serif;
  box-shadow:0 0 10px #ff00c8aa; letter-spacing:.5px; margin:4px 4px 4px 0;
}
.btn:active { transform:scale(.95); filter:brightness(1.3); }
.btn:disabled { background:#444; color:#aaa; box-shadow:none; cursor:not-allowed; }

input[type="text"],input[type="number"],input[type="range"] {
  background:#181828; border:2px solid #ff00c8; border-radius:6px;
  color:#00ffd0; padding:6px 8px; font-family:'Orbitron',sans-serif;
}
.team { background:linear-gradient(90deg,#2b0057,#00ffd0); padding:8px; margin:6px 0; border-radius:8px; box-shadow:0 0 8px #00ffd044; }
.fixture-card { background:#18003a; border:2px solid #00ffd0; border-radius:12px; padding:1em; margin-bottom:12px; box-shadow:0 0 18px #00ffd055; }

/* Flex util */
.flex { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

/* Top-right controls */
.top-right-controls {
  position:fixed; top:10px; right:10px; z-index:12000;
  display:flex; gap:10px; flex-wrap:wrap;
  background:rgba(32,0,74,.78); padding:10px 14px; border:2px solid #00ffd0;
  border-radius:14px; box-shadow:0 6px 24px #0008;
  backdrop-filter:blur(6px);
}
.toggle-group { display:flex; align-items:center; gap:6px; font-size:11px; font-family:'Orbitron',sans-serif; color:#ffb700; }
.toggle-group input { width:22px; height:22px; cursor:pointer; }

/* Match modal & intro simplified */
.fullscreen-modal { position:fixed; inset:0; background:rgba(12,4,28,0.95); display:none; align-items:center; justify-content:center; z-index:10000; }
.fullscreen-modal .modal-content { position:relative; background:#160034; border:2px solid #00ffd0; border-radius:18px; padding:24px; max-width:95vw; box-shadow:0 0 30px #ff00c8aa; }
.close-btn { position:absolute; top:12px; right:18px; font-size:40px; line-height:24px; color:#ff00c8; background:none; border:none; cursor:pointer; }
.close-btn:hover { color:#00ffd0; }

/* Base cups in matches */
.cup-btn { width:45px; height:45px; background:transparent; border:none; margin:2px; cursor:pointer; }
.cup-btn img { width:45px; height:45px; border-radius:50%; border:2px solid #ff00c8; box-shadow:0 0 10px #ff00c8; background:#222; }
.cup-btn.hit img { filter:grayscale(1) brightness(.4); opacity:.35; border-color:#00ffd0; box-shadow:0 0 16px #00ffd0; }

/* ---------- VIINAHARAVA AREA ---------- */
#losersGameModal { z-index:20050 !important; }
#losersGameModal .modal-content {
  width: min(100%, 640px);
  display:flex; flex-direction:column; align-items:center;
}

#losersGameModal .cups-area {
  position:relative;
  width: min(440px, 90vw);
  height: calc(100vh * var(--vh-area-scale));
  max-height: 860px;
  min-height: 480px;
  background:#210050;
  border-radius:32px;
  box-shadow:0 0 40px #00ffd077, inset 0 0 28px #000;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

#losersGameModal .table-wrapper {
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  pointer-events:none;
  background:
    radial-gradient(circle at 50% 50%, #330072 0%, #140026 80%);
}

#losersGameModal .table-wrapper img.table-img {
  width:auto;
  height:100%;
  max-height:100%;
  transform-origin:center center;
  transform: rotate(90deg) scale(var(--table-scale));
  opacity:.92;
  filter: drop-shadow(0 0 18px #000);
}

/* Cup grid overlay */
#losersGrid {
  position:absolute;
  top:50%; left:50%;
  transform: translate(-50%, calc(-50% + var(--grid-offset-y)));
  width: var(--vh-grid-size);
  height: var(--vh-grid-size);
  display:grid;
  grid-template-columns:repeat(4,1fr);
  grid-template-rows:repeat(4,1fr);
  gap:14px;
  z-index:5;
  pointer-events:auto;
}

#losersGrid .cup-btn {
  width:var(--cup-size);
  height:var(--cup-size);
  margin:0;
  position:relative;
  transition: transform .15s;
}
#losersGrid .cup-btn:hover { transform:scale(1.08); }
#losersGrid .cup-btn img {
  width:var(--cup-size);
  height:var(--cup-size);
  border:2px solid #ff00c8;
  border-radius:50%;
  box-shadow:0 0 12px #ff00c8;
  background:#222;
  transition: filter .25s, box-shadow .25s;
}
#losersGrid .cup-btn.hit img {
  filter:grayscale(1) brightness(.35);
  border-color:#00ffd0;
  box-shadow:0 0 18px #00ffd0;
  opacity:.35;
}

#losersGameModal.losers-ended #losersGrid {
  opacity:.55;
  filter:grayscale(70%);
  pointer-events:none;
}

#throwResult .result-drink {
  font-size:1.55em;
  padding:8px 18px;
  font-weight:bold;
  text-shadow:0 0 6px currentColor;
  border:2px solid currentColor;
  border-radius:10px;
  background:rgba(0,0,0,0.35);
}

.debug-overlay-target {
  position:absolute;
  inset:0;
  border:3px dashed #ffb70088;
  pointer-events:none;
  z-index:4;
  mix-blend-mode:screen;
  display:none;
}

.debug-mode #losersGameModal .cups-area { outline:3px solid #ffb700; }
.debug-mode #losersGrid { outline:2px solid #00ffd0; }
.debug-mode .debug-overlay-target { display:block; }
.debug-mode #losersGrid .cup-btn::after {
  content:attr(data-i);
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  font-weight:bold;
  color:#ffb700;
  text-shadow:0 0 6px #000;
  pointer-events:none;
}

/* Throw result panel */
#throwResult {
  background:#12002a;
  border:2px solid #00ffd0;
  border-radius:14px;
  padding:16px 18px;
  box-shadow:0 0 18px #00ffd066;
  max-width:420px;
}

.small-note { font-size:11px; opacity:.7; margin-top:8px; }

/* Standings (main table) */
table.standings { width:100%; border-collapse:collapse; margin-top:12px; background:#2b0057; }
table.standings th, table.standings td { padding:8px 6px; border:1px solid #ff00c8; font-size:12px; text-align:center; }
table.standings th { background:#18003a; color:#00ffd0; }

.sidebar-overlay {
  display:none;
  position:fixed;
  top:0; right:0;
  width:230px; height:100vh;
  background:#18003acc;
  backdrop-filter:blur(5px);
  border-left:3px solid #00ffd0;
  padding:10px;
  z-index:10500;
  overflow:auto;
  font-size:12px;
}
.sidebar-overlay table { width:100%; border-collapse:collapse; }
.sidebar-overlay th, .sidebar-overlay td { border:1px solid #00ffd0; padding:4px; }
.sidebar-overlay tr.active-team { background:#ffb700; color:#222; font-weight:bold; }

.close-btn:focus, .btn:focus, input:focus { outline:2px solid #ffb700; outline-offset:2px; }

/* Big alert */
#bigAlertModal {
  position:fixed; inset:0;
  display:none;
  z-index:14000;
  background:rgba(8,2,20,0.92);
  align-items:center; justify-content:center;
  padding:14px;
}
#bigAlertInner {
  width:min(92vw,720px);
  background:#160030;
  border:2px solid #00ffd0;
  border-radius:16px;
  padding:20px 24px;
  box-shadow:0 0 40px #ff00c8aa;
}
#bigAlertInner h2 { margin:0 0 8px; color:#ffb700; text-shadow:0 0 10px #ffb70066; font-size:1.05em; }
#bigAlertInner p { white-space:pre-wrap; font-size:13px; color:#00ffd0; line-height:1.4; }

/* Responsive tweak */
@media (max-width:600px) {
  :root {
    --vh-grid-size: 180px;
    --cup-size: 34px;
    --table-scale: 0.82;
  }
  #losersGameModal .cups-area {
    width: 300px;
    height: calc(100vh * var(--vh-area-scale));
    min-height:500px;
  }
  .top-right-controls { gap:6px; padding:8px 10px; }
  .fixture-card { padding:.9em; }
  h1 { font-size:1.4em; }
}
</style>
</head>
<body>

<!-- TOP CONTROLS -->
<div class="top-right-controls">
  <div class="toggle-group"><label>Äänet <input type="checkbox" id="soundToggle"></label></div>
  <div class="toggle-group"><label>Testitoiminnot <input type="checkbox" id="testFeaturesToggle"></label></div>
  <div class="toggle-group"><label>Debug Mode <input type="checkbox" id="debugToggle"></label></div>
</div>

<div class="container" style="padding:18px 26px; max-width:1300px; margin:0 auto;">
  <h1>Keikahdusliiga</h1>

  <div class="section" id="setup">
    <h2>Luo liigaturnaus</h2>
    <div class="flex" style="align-items:flex-end;">
      <label>Joukkuekoko:
        <input type="range" min="1" max="4" value="2" id="teamSizeSlider" style="width:120px;">
        <span id="teamSizeVal">2</span>
      </label>
      <label style="display:flex;align-items:center;gap:6px;">
        <input type="checkbox" id="goldenGoalCheckbox"> Golden goal
      </label>
      <label>Peliaika:
        <input type="number" id="timerInput" min="1" max="60" value="10" style="width:60px;"> min
      </label>
      <button class="btn" id="addTeamBtn">Lisää</button>
      <label style="display:flex;flex-direction:column;font-size:11px;gap:4px;">
        <span>.CSV</span>
        <input type="file" accept=".csv" id="csvInput" style="width:150px;">
      </label>
      <button class="btn" id="testModeBtn">Testaus</button>
      <button class="btn" id="resetBtn">Nollaa</button>
    </div>
    <div id="teamList" class="team-list"></div>
    <button id="startTournamentBtn" class="btn" style="display:none;">Käynnistä turnaus</button>
    <div class="small-note">Debug Mode näyttää rajat & cup indexit. Viinaharava testipainike ilmestyy, kun Testitoiminnot päällä.</div>
  </div>

  <div class="section" id="fixturesSection" style="display:none;">
    <h2>Ottelukaavio</h2>
    <div id="fixtureList" class="fixture-list"></div>
  </div>

  <div class="section" id="standingsSection" style="display:none;">
    <h2>Sarjataulukko</h2>
    <div id="standingsTable"></div>
  </div>
</div>

<!-- MATCH MODAL -->
<div class="fullscreen-modal" id="fullscreenModal" style="display:none;">
  <div class="modal-content" id="modalContent"></div>
  <div id="sidebarOverlay" class="sidebar-overlay"></div>
  <button class="close-btn" id="closeModalBtn" type="button">&times;</button>
</div>

<!-- BIG ALERT -->
<div id="bigAlertModal" aria-hidden="true">
  <div id="bigAlertInner">
    <h2 id="bigAlertTitle">Alert</h2>
    <p id="bigAlertMessage">Message</p>
    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:12px;">
      <button class="btn" id="bigAlertCloseBtn" type="button">Sulje</button>
    </div>
  </div>
</div>

<!-- INTRO OVERLAY -->
<div class="match-intro-overlay" id="matchIntroOverlay" style="display:none;">
  <div class="match-intro-bars">
    <div class="bar top"></div>
    <div class="bar bottom"></div>
    <div class="match-intro-names">
      <span class="team top" id="introTeamTop"></span>
      <span class="vs">VS</span>
      <span class="team bottom" id="introTeamBottom"></span>
    </div>
  </div>
</div>

<!-- VIINAHARAVA MODAL -->
<div id="losersGameModal" class="fullscreen-modal" style="display:none;">
  <div class="modal-content">
    <h2>Viinaharava</h2>
    <div style="margin-bottom: 15px; font-size: 1.0em; text-align:center;">
      <span id="loserTeamName" style="color:#00ffd0;"></span> |
      <span id="currentThrower" style="color:#ff00c8;"></span> heittää
    </div>
    <div class="cups-area" id="losersArea">
      <div class="table-wrapper">
        <img src="assets/table.png" class="table-img" alt="Table" onerror="this.style.display='none'">
      </div>
      <div id="losersGrid"></div>
      <div class="debug-overlay-target" id="debugOverlayTarget"></div>
    </div>

    <div id="throwResult" style="display:none; margin: 18px auto 10px; text-align:center;">
      <h3 id="resultTitle" style="margin:0 0 8px;">Osuma!</h3>
      <div id="resultContent" class="result-content"></div>
    </div>

    <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:14px;margin-top:12px;">
      <button class="btn" id="finishLosersGameBtn" type="button">Sulje peli</button>
      <button class="btn" id="resetLosersViewBtn" type="button">Reset View</button>
    </div>
    <div class="small-note">Peli päättyy heti kun toinen pelaaja saa ei-RETHROW tuloksen.</div>
  </div>
  <button class="close-btn" id="closeLosersGameBtn" type="button">&times;</button>
</div>

<script>
/* =========================================================
   CONFIG QUICK FLAGS
========================================================= */
const ROTATE_TABLE = true; // Set false to remove rotation (debug)
const LOG_PREFIX = "[Viinaharava]";

/* =========================================================
   GLOBAL STATE
========================================================= */
let teams = [];
let teamInputs = [];
let teamSize = 2;
let tournamentStarted = false;
let fixtures = [];
let knockoutFixtures = [];
let matchResults = {};
let phase = "league";
let leagueCups = 6;
let knockoutCups = 10;
let goldenGoalEnabled = false;
let leagueTimer = 10 * 60;
let ongoingMatchId = null;
let timerInterval = null;
let cupStates = {};

/* Viinaharava */
let losersGameActive = false;
let losersGameEnded = false;
let losersTeam = null;
let losersPlayers = [];
let currentLoserIndex = 0;
let losersCupResults = [];

/* Toggles */
let soundEnabled = false;
let testFeaturesEnabled = false;
let debugMode = false;

/* DOM refs */
const soundToggleEl = document.getElementById('soundToggle');
const testFeaturesToggleEl = document.getElementById('testFeaturesToggle');
const debugToggleEl = document.getElementById('debugToggle');

/* =========================================================
   HELPERS: ALERT
========================================================= */
const bigAlertModal = document.getElementById('bigAlertModal');
const bigAlertTitleEl = document.getElementById('bigAlertTitle');
const bigAlertMessageEl = document.getElementById('bigAlertMessage');
const bigAlertCloseBtn = document.getElementById('bigAlertCloseBtn');

function showBigAlert(title, msg, opts={}) {
  bigAlertTitleEl.textContent = title || 'Info';
  bigAlertMessageEl.textContent = typeof msg === 'string' ? msg : JSON.stringify(msg,null,2);
  bigAlertModal.style.display = 'flex';
  if (bigAlertModal._t) clearTimeout(bigAlertModal._t);
  if (opts.autoCloseMs) {
    bigAlertModal._t = setTimeout(()=>hideBigAlert(), opts.autoCloseMs);
  }
}
function hideBigAlert() {
  bigAlertModal.style.display = 'none';
  if (bigAlertModal._t) { clearTimeout(bigAlertModal._t); bigAlertModal._t = null; }
}
bigAlertCloseBtn?.addEventListener('click', hideBigAlert);

/* =========================================================
   TOGGLE LISTENERS
========================================================= */
soundToggleEl?.addEventListener('change', e => { soundEnabled = e.target.checked; });
testFeaturesToggleEl?.addEventListener('change', e => {
  testFeaturesEnabled = e.target.checked;
  document.getElementById('testModeBtn').disabled = !testFeaturesEnabled;
  const vb = document.getElementById('viinaharavaBtn');
  if (vb) vb.disabled = !testFeaturesEnabled;
  renderFixtures();
});
debugToggleEl?.addEventListener('change', e => {
  debugMode = e.target.checked;
  document.body.classList.toggle('debug-mode', debugMode);
});

/* =========================================================
   VIINAHARAVA LOGIC
========================================================= */
const losersCupTypes = [
  { type: 'BAILEYS', count: 4, color: '#A67B5B' },
  { type: 'SALMARI', count: 4, color: '#000000' },
  { type: 'JÄGERMEISTER', count: 1, color: '#72A331' },
  { type: 'RETHROW', count: 2, color: '#3B88C3' },
  { type: 'WILD', count: 2, color: '#FFB700' },
  { type: 'MINTTU', count: 3, color: '#00ffd0' }
];

function startLosersGame(losingTeam, onComplete) {
  if (!losingTeam || !losingTeam.players?.length) {
    onComplete?.();
    return;
  }
  console.log(LOG_PREFIX, "Starting with team:", losingTeam.name);

  if (timerInterval) { clearInterval(timerInterval); timerInterval=null; }
  document.getElementById('fullscreenModal').style.display='none';
  document.getElementById('matchIntroOverlay').style.display='none';
  hideSidebar();

  losersGameActive = true;
  losersGameEnded = false;
  losersTeam = losingTeam;
  losersPlayers = losingTeam.players.slice(0,2); // only first two
  currentLoserIndex = 0;
  window.losersGameCompleteCallback = onComplete || null;

  // Distribution
  const all = [];
  losersCupTypes.forEach(t=>{
    for(let i=0;i<t.count;i++) all.push({...t});
  });
  for (let i=all.length-1;i>0;i--) {
    const j=Math.floor(Math.random()*(i+1));
    [all[i],all[j]]=[all[j],all[i]];
  }
  losersCupResults = all;

  // UI
  document.getElementById('loserTeamName').textContent = losingTeam.name;
  document.getElementById('currentThrower').textContent = losersPlayers[currentLoserIndex] || 'Unknown';
  document.getElementById('throwResult').style.display='none';
  renderLosersCups();
  const modal = document.getElementById('losersGameModal');
  modal.classList.remove('losers-ended');
  modal.style.display='flex';

  applyRotationSetting();
}

function applyRotationSetting() {
  const img = document.querySelector('#losersGameModal .table-img');
  if (!img) return;
  img.style.transform = ROTATE_TABLE
    ? `rotate(90deg) scale(var(--table-scale))`
    : `rotate(0deg) scale(var(--table-scale))`;
}

function renderLosersCups() {
  const grid = document.getElementById('losersGrid');
  if(!grid) return;
  grid.innerHTML='';
  for(let i=0;i<16;i++) {
    const btn=document.createElement('button');
    btn.className='cup-btn losers-cup';
    btn.dataset.index=i;
    btn.setAttribute('data-i', i);
    const img=document.createElement('img');
    img.src='assets/redcup.png';
    img.onerror=function(){ this.src='redcup.png'; };
    img.alt='Cup';
    btn.appendChild(img);
    btn.addEventListener('click',()=>handleLosersCupClick(btn,i));
    grid.appendChild(btn);
  }
  if (debugMode) console.log(LOG_PREFIX, "Rendered 16 cups");
}

function handleLosersCupClick(btn, idx) {
  if(!losersGameActive || losersGameEnded) return;
  if(btn.classList.contains('hit')) return;
  btn.classList.add('hit');

  const result = losersCupResults[idx];
  console.log(LOG_PREFIX, "Cup", idx, "->", result.type);

  document.getElementById('resultTitle').textContent='OSUMA!';
  const rc=document.getElementById('resultContent');
  rc.innerHTML=`
    <div class="result-drink" style="color:${result.color};border-color:${result.color};">${result.type}</div>
    <button class="btn" id="nextThrowBtn">${
      result.type==='RETHROW'
        ? (currentLoserIndex===1 ? 'UUDELLEENHEITTO (2. Pelaaja)' : 'UUDELLEENHEITTO')
        : (currentLoserIndex===0 ? 'SEURAAVA HEITTÄJÄ' : 'LOPETA')
    }</button>
  `;
  document.getElementById('throwResult').style.display='block';

  document.getElementById('nextThrowBtn').addEventListener('click',()=>{
    document.getElementById('throwResult').style.display='none';

    if(result.type==='RETHROW'){
      console.log(LOG_PREFIX,"RETHROW -> same player again");
      return;
    }
    currentLoserIndex++;
    if(currentLoserIndex>=2 || currentLoserIndex>=losersPlayers.length){
      endLosersGame();
    } else {
      document.getElementById('currentThrower').textContent =
        losersPlayers[currentLoserIndex] || 'Unknown';
    }
  }, { once:true });
}

function endLosersGame() {
  if(losersGameEnded) return;
  console.log(LOG_PREFIX,"Ending losers game.");
  losersGameActive=false;
  losersGameEnded=true;
  disableLosersCups();
  document.getElementById('losersGameModal').classList.add('losers-ended');
  showBigAlert('Peli valmis','Häviäjien peli on päättynyt!',{autoCloseMs:2000});
  setTimeout(()=>finishLosersGame(), 2200);
}

function disableLosersCups() {
  document.querySelectorAll('#losersGrid .cup-btn').forEach(b=>b.style.pointerEvents='none');
}

function finishLosersGame() {
  const modal=document.getElementById('losersGameModal');
  modal.style.display='none';
  losersGameActive=false;
  losersGameEnded=true;
  if(window.losersGameCompleteCallback){
    window.losersGameCompleteCallback();
    window.losersGameCompleteCallback=null;
  }
}

/* Public test helper */
window.testLosersGame = () => startLosersGame({name:"Joukkue 1", players:["Pelaaja 1","Pelaaja 2"]});

/* Reset view (debug) */
document.getElementById('resetLosersViewBtn')?.addEventListener('click',()=>{
  console.log(LOG_PREFIX,"Reset view clicked");
  document.documentElement.style.setProperty('--grid-offset-y','0px');
  document.documentElement.style.setProperty('--table-scale','0.9');
});

/* Finish & close buttons */
document.getElementById('finishLosersGameBtn')?.addEventListener('click', finishLosersGame);
document.getElementById('closeLosersGameBtn')?.addEventListener('click', finishLosersGame);

/* =========================================================
   TEAM / TOURNAMENT (trimmed but functional)
========================================================= */
document.getElementById('teamSizeSlider').oninput=function(){
  teamSize=+this.value;
  document.getElementById('teamSizeVal').textContent=teamSize;
};
document.getElementById('goldenGoalCheckbox').onchange=function(){ goldenGoalEnabled=this.checked; };
document.getElementById('timerInput').oninput=function(){ leagueTimer=+this.value*60; };

document.getElementById('addTeamBtn').onclick=()=>{
  if(tournamentStarted) return;
  teamInputs.push({name:"",players:Array(teamSize).fill("")});
  renderTeamList();
  updateStartButton();
};

document.getElementById('csvInput').onchange=handleCSVUpload;
function handleCSVUpload(e){
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=evt=>{
    let txt=evt.target.result;
    if(txt instanceof ArrayBuffer) txt=new TextDecoder("utf-8").decode(txt);
    let delim=txt.includes(";")?";":",";
    let rows=txt.trim().split("\n");
    if(rows[0].toLowerCase().includes("joukkue")||rows[0].toLowerCase().includes("team")) rows=rows.slice(1);
    const map={};
    rows.forEach(r=>{
      const parts=r.split(delim);
      if(parts.length<2) return;
      const t=parts[0].trim(), p=parts[1].trim();
      if(!map[t]) map[t]=[];
      map[t].push(p);
    });
    teamInputs=[]; teams=[];
    Object.entries(map).forEach(([name, players])=>{
      teamInputs.push({name, players:[...players]});
      teams.push({name, players:[...players]});
    });
    renderTeamList();
    updateStartButton();
  };
  reader.readAsText(file);
}

document.getElementById('testModeBtn').onclick=testMode;
function testMode(){
  const teamNames=["Red Devils","Beer Bros","Cup Kings","Pong Stars","Sudden Death","Last Call"];
  const playerNames=["Alex","Sam","Jamie","Taylor","Jordan","Morgan","Riley","Casey","Reese","Charlie","Drew","Skyler"];
  let nTeams=6;
  teams=[]; teamInputs=[];
  for(let i=0;i<nTeams;i++){
    let tn=teamNames[i%teamNames.length];
    let ps=[];
    for(let j=0;j<teamSize;j++){
      ps.push(playerNames[Math.floor(Math.random()*playerNames.length)]);
    }
    teams.push({name:tn, players:ps});
    teamInputs.push({name:tn, players:[...ps]});
  }
  tournamentStarted=true;
  renderTeamList();
  generateFixtures();
  document.getElementById('fixturesSection').style.display='';
  document.getElementById('standingsSection').style.display='';
  renderFixtures();
  renderStandings();
}

/* Reset */
document.getElementById('resetBtn').onclick=()=>{
  teams=[]; teamInputs=[]; fixtures=[]; knockoutFixtures=[]; cupStates={};
  tournamentStarted=false; phase="league"; teamSize=2; ongoingMatchId=null;
  document.getElementById('teamSizeSlider').value=2;
  document.getElementById('teamSizeVal').textContent=2;
  ['teamList','fixtureList','standingsTable'].forEach(id=>document.getElementById(id).innerHTML='');
  document.getElementById('fixturesSection').style.display='none';
  document.getElementById('standingsSection').style.display='none';
  document.getElementById('fullscreenModal').style.display='none';
  document.getElementById('sidebarOverlay').style.display='none';
  document.getElementById('matchIntroOverlay').style.display='none';
  document.getElementById('startTournamentBtn').style.display='none';
  if(timerInterval) clearInterval(timerInterval);
  hideBigAlert();
  soundEnabled=false; testFeaturesEnabled=false; debugMode=false;
  soundToggleEl.checked=false; testFeaturesToggleEl.checked=false; debugToggleEl.checked=false;
  document.getElementById('viinaharavaBtn')?.remove();
  console.log(LOG_PREFIX,"Reset complete");
  renderFixtures();
};

/* Team list rendering */
function renderTeamList(){
  const el=document.getElementById('teamList');
  el.innerHTML='';
  const src=tournamentStarted?teams:teamInputs;
  src.forEach((t,idx)=>{
    const div=document.createElement('div');
    div.className='team';
    if(!tournamentStarted){
      div.innerHTML=`
        <input type="text" value="${t.name}" placeholder="Joukkue" 
          oninput="updateTeamInput(${idx},'name',this.value)" style="margin-right:10px;">
        ${t.players.map((p,i)=>`<input type="text" value="${p}" placeholder="P ${i+1}"
           oninput="updateTeamInput(${idx},'player',this.value,${i})" style="margin-right:6px;width:90px;">`).join('')}
        <button class="btn" onclick="removeTeam(${idx})">X</button>
      `;
    } else {
      div.textContent = `${t.name} (${t.players.length}): ${t.players.join(', ')}`;
    }
    el.appendChild(div);
  });
  updateStartButton();
}
window.updateTeamInput=function(idx, field, value, pi){
  if(!teamInputs[idx]) return;
  if(field==='name') teamInputs[idx].name=value;
  else if(field==='player') teamInputs[idx].players[pi]=value;
  updateStartButton();
};
window.removeTeam=function(idx){
  teamInputs.splice(idx,1);
  renderTeamList();
  updateStartButton();
};

function updateStartButton(){
  const btn=document.getElementById('startTournamentBtn');
  const ok = !tournamentStarted &&
    teamInputs.length>=2 &&
    teamInputs.every(t=>t.name && t.players.every(p=>p && p.trim()));
  btn.style.display = ok ? '' : 'none';
}

document.getElementById('startTournamentBtn').onclick=beginTournament;
function beginTournament(){
  tournamentStarted=true;
  teams=teamInputs.map(t=>({name:t.name, players:[...t.players]}));
  renderTeamList();
  generateFixtures();
  document.getElementById('fixturesSection').style.display='';
  document.getElementById('standingsSection').style.display='';
  renderFixtures();
  renderStandings();
}

/* Fixtures generation */
function generateFixtures(){
  fixtures=[];
  let n=teams.length;
  let rounds = n%2===0 ? n-1 : n;
  let list=[...teams];
  if(n%2===1){ list.push({name:"BYE", players:[]}); n++; }
  let counter=1, maxGames=30, played=0;
  outer: for(let r=0;r<rounds;r++){
    for(let i=0;i<n/2;i++){
      let a=list[i], b=list[n-1-i];
      if(a.name!=="BYE" && b.name!=="BYE"){
        fixtures.push({
          id:`R${r+1}_${i}`,
          teams:[a,b],
          phase:"league",
          cups:leagueCups,
          winner:null,
          score:null,
          suddenDeath:false,
          time:null,
          awaitingConfirm:false,
          number: counter++
        });
        played++;
        if(played>=maxGames) break outer;
      }
    }
    list.splice(1,0,list.pop());
  }
  ongoingMatchId=null;
}

/* Fixtures rendering */
function getMatchTitle(match, idx){
  if(match.phase==="league") return `Sarjaottelu ${match.number}`;
  if(match.id==="SF1") return "Semifinaali 1";
  if(match.id==="SF2") return "Semifinaali 2";
  if(match.id==="Final") return "Finaali";
  if(match.id==="Bronze") return "Pronssiottelu";
  return "Ottelu";
}

function getMatchResultText(m){
  if(!m.winner||!m.score) return "";
  return `${m.teams[0].name} ${m.score[0]} - ${m.score[1]} ${m.teams[1].name} (${m.winner})`;
}

function renderFixtures(){
  const list=document.getElementById('fixtureList');
  list.innerHTML='';
  if(testFeaturesEnabled){
    const wrap=document.createElement('div');
    wrap.style.textAlign='right';
    wrap.innerHTML=`<button class="btn" onclick="generateAllResults()">Generoi kaikki</button>`;
    list.appendChild(wrap);
  }
  const arr = phase==="knockout" ? knockoutFixtures : fixtures;
  arr.forEach((m,idx)=>{
    const card=document.createElement('div');
    card.className='fixture-card';
    let btnHTML="";
    if(!ongoingMatchId) btnHTML=`<button class="btn" onclick="startMatch('${m.id}')">Aloita</button>`;
    else if(ongoingMatchId===m.id) btnHTML=`<button class="btn" onclick="spectateMatch('${m.id}')">Katsele</button>`;
    else btnHTML=`<button class="btn" disabled>Varattu</button>`;
    if(m.winner) btnHTML="";

    const testBtn = testFeaturesEnabled && !m.winner
      ? `<button class="btn" onclick="promptAndApplyResult('${m.id}')">Syötä tulos</button>`
      : '';

    card.innerHTML=`
      <div class="game-title">${getMatchTitle(m,idx)}</div>
      <div><b>${m.teams[0].name}</b> vs <b>${m.teams[1].name}</b></div>
      ${m.winner?`<div>Voittaja: ${m.winner}</div>`:''}
      ${m.score?`<div class="game-result">${getMatchResultText(m)}</div>`:''}
      <div class="flex">${btnHTML}${testBtn}</div>
      <div style="font-size:11px;opacity:.7;">${m.cups} mukia ${m.phase==="league"?`| ${Math.round(leagueTimer/60)} min`:'| Knockout'}</div>
    `;
    list.appendChild(card);
  });
}

/* Cup handling for normal match gameplay */
function getMatchById(id){
  return [...fixtures,...knockoutFixtures].find(m=>m && m.id===id) || null;
}

function renderCupSet(teamIdx, match){
  if(!match?.teams?.[teamIdx]) return '';
  let nCups=match.cups;
  let layout = nCups===6 ? [3,2,1] : [4,3,2,1];
  let label=match.teams[teamIdx].name;
  let key=`${match.id}_${teamIdx}`;
  let sideClass=teamIdx===0?'left':'right';
  let rows=[];
  layout.forEach((n,r)=>{
    let start = layout.slice(0,r).reduce((a,b)=>a+b,0);
    let row = `<div class="cup-row ${teamIdx===1?'reverse':''}">`;
    let indices=[...Array(n).keys()].map(i=>start+i);
    if(teamIdx===1) indices=indices.reverse();
    indices.forEach(ci=>{
      let hit=cupStates[key]?.[ci];
      row+=`<button class="cup-btn${hit?' hit':''}" onclick="toggleCup('${key}',${ci})">
              <img src="assets/redcup.png" alt="Cup">
            </button>`;
    });
    row+='</div>';
    rows.push(row);
  });
  return `<div class="cup-set ${sideClass}">
    <div class="cup-label">${label}</div>
    ${rows.join('')}
  </div>`;
}

window.toggleCup=function(key, idx){
  if(!cupStates[key]) cupStates[key]=[];
  cupStates[key][idx]=!cupStates[key][idx];
  if(ongoingMatchId){
    let m=getMatchById(ongoingMatchId);
    if(!m) return;
    let leftKey=`${m.id}_0`, rightKey=`${m.id}_1`;
    let leftDown=cupStates[leftKey]?.filter(Boolean).length||0;
    let rightDown=cupStates[rightKey]?.filter(Boolean).length||0;
    if((leftDown>=m.cups||rightDown>=m.cups)&&!m.awaitingConfirm){
      m.awaitingConfirm=true;
      setTimeout(()=>showEndMatchModal(m,leftDown,rightDown),300);
    }
  }
};

function showEndMatchModal(m,leftDown,rightDown){
  let cups=m.cups;
  let winnerIdx=null, loserScore=0;
  if(leftDown>=cups){ winnerIdx=1; loserScore=rightDown; }
  else if(rightDown>=cups){ winnerIdx=0; loserScore=leftDown; }
  let winnerName=m.teams[winnerIdx].name;
  const modal=document.getElementById('fullscreenModal');
  const content=document.getElementById('modalContent');
  content.innerHTML=`
    <h2>Voittaja: ${winnerName}</h2>
    <p>${m.teams[0].name} upotetut: ${rightDown}<br>${m.teams[1].name} upotetut: ${leftDown}</p>
    <div class="flex">
      <button class="btn" onclick="confirmAutoScore('${m.id}',${winnerIdx},${cups},${loserScore})">Vahvista</button>
      <button class="btn" onclick="returnToMatch('${m.id}')">Peruuta</button>
    </div>
  `;
  modal.style.display='flex';
}

window.confirmAutoScore=function(id,wIdx,wScore,lScore){
  const m=getMatchById(id);
  if(!m) return;
  m.winner=m.teams[wIdx].name;
  m.score=wIdx===0 ? [wScore,lScore] : [lScore,wScore];
  m.awaitingConfirm=false;
  ongoingMatchId=null;
  if(timerInterval){ clearInterval(timerInterval); timerInterval=null; }
  document.getElementById('fullscreenModal').style.display='none';
  hideSidebar();
  const losingTeam=m.teams[wIdx===0?1:0];
  startLosersGame(losingTeam,()=>{
    renderFixtures(); renderStandings(); checkLeagueCompletion(); if(phase==="knockout") checkKnockoutProgression();
  });
};

window.returnToMatch=function(id){
  const m=getMatchById(id);
  if(!m) return;
  m.awaitingConfirm=false;
  document.getElementById('fullscreenModal').style.display='none';
  showActiveMatch(id);
};

window.startMatch=function(id){
  ongoingMatchId=id;
  renderFixtures();
  playIntroAnimation(id,()=>showActiveMatch(id));
};
window.spectateMatch=function(id){ showActiveMatch(id); };

function playIntroAnimation(id,cb){
  const m=getMatchById(id);
  if(!m) return;
  document.getElementById('introTeamTop').textContent=m.teams[0].name;
  document.getElementById('introTeamBottom').textContent=m.teams[1].name;
  const overlay=document.getElementById('matchIntroOverlay');
  overlay.style.display='flex';
  setTimeout(()=>overlay.classList.add('animate'),10);
  setTimeout(()=>{
    overlay.classList.remove('animate');
    overlay.style.display='none';
    cb?.();
  },2500);
}

window.showActiveMatch=function(id){
  const m=getMatchById(id);
  if(!m) return;
  let left=renderCupSet(0,m), right=renderCupSet(1,m);
  let result = getMatchResultText(m);
  let modal=document.getElementById('fullscreenModal');
  let content=document.getElementById('modalContent');
  let confirm='';
  if(m.awaitingConfirm){
    let leftKey=`${m.id}_0`, rightKey=`${m.id}_1`;
    let leftDown=cupStates[leftKey]?.filter(Boolean).length||0;
    let rightDown=cupStates[rightKey]?.filter(Boolean).length||0;
    let wIdx= leftDown>=m.cups ? 1:0;
    let loser = wIdx===0 ? leftDown : rightDown;
    confirm=`
      <div style="background:#ff00c822;padding:10px;border-radius:10px;">
        <h3>Ottelu päättynyt</h3>
        <button class="btn" onclick="confirmAutoScore('${m.id}',${wIdx},${m.cups},${loser})">Vahvista</button>
        <button class="btn" onclick="returnToMatch('${m.id}')">Peruuta</button>
      </div>`;
  }
  content.innerHTML=`
    <h2>${m.teams[0].name} <span style="color:#ffb700;">VS</span> ${m.teams[1].name}</h2>
    <div class="cups-area" style="max-width:870px;">
      <img src="assets/table.png" class="table-img">
      ${left}${right}
    </div>
    ${result?`<div class="game-result">${result}</div>`:''}
    ${confirm}
    <div style="margin-top:10px;">
      <button class="btn" onclick="closeMatchView()">Pienennä</button>
    </div>
  `;
  modal.style.display='flex';
  showSidebar();
}

window.closeMatchView=function(){
  document.getElementById('fullscreenModal').style.display='none';
  hideSidebar();
  if(timerInterval) clearInterval(timerInterval);
};
document.getElementById('closeModalBtn').onclick=()=>closeMatchView();

function formatTime(s){ let m=Math.floor(s/60), ss=s%60; return `${m}:${ss<10?'0':''}${ss}`; }

function showSidebar(){
  const sb=document.getElementById('sidebarOverlay');
  sb.innerHTML=`<h3 style="margin:4px 0 6px;">Sarja</h3>${renderSidebarStandings()}`;
  sb.style.display='block';
}
function hideSidebar(){ document.getElementById('sidebarOverlay').style.display='none'; }

function renderSidebarStandings(){
  const all=[...fixtures,...knockoutFixtures];
  const stats={};
  teams.forEach(t=>stats[t.name]={pts:0,S:0,SC:0,SD:0,played:0,W:0,L:0});
  all.forEach(m=>{
    if(!m.winner||!m.score) return;
    let [s1,s2]=m.score;
    let t1=m.teams[0].name, t2=m.teams[1].name;
    stats[t1].played++; stats[t2].played++;
    if(m.winner===t1){ stats[t1].pts+=2; stats[t1].W++; stats[t2].L++; }
    else { stats[t2].pts+=2; stats[t2].W++; stats[t1].L++; }
    stats[t1].S+=s1; stats[t1].SC+=s2; stats[t2].S+=s2; stats[t2].SC+=s1;
  });
  Object.keys(stats).forEach(k=>stats[k].SD=stats[k].S-stats[k].SC);
  let sorted=Object.entries(stats).sort((a,b)=>{
    if(b[1].pts!==a[1].pts) return b[1].pts-a[1].pts;
    if(b[1].SD!==a[1].SD) return b[1].SD-a[1].SD;
    if(b[1].S!==a[1].S) return b[1].S-a[1].S;
    return b[1].SC-a[1].SC;
  });
  let active=[];
  if(ongoingMatchId){
    const m=getMatchById(ongoingMatchId);
    if(m) active=[m.teams[0].name,m.teams[1].name];
  }
  let html='<table><tr><th>J</th><th>P</th><th>W</th><th>L</th><th>Pts</th><th>SD</th></tr>';
  sorted.forEach(([n,s])=>{
    html+=`<tr${active.includes(n)?' class="active-team"':''}>
      <td>${abbrev(n)}</td><td>${s.played}</td><td>${s.W}</td><td>${s.L}</td><td>${s.pts}</td><td>${s.SD}</td>
    </tr>`;
  });
  html+='</table>';
  return html;
}
function abbrev(name){
  const parts=name.split(/\s+/).filter(Boolean);
  if(parts.length===1) return parts[0].slice(0,3).toUpperCase();
  return parts.slice(0,3).map(w=>w[0].toUpperCase()).join('');
}

/* Standings main table */
function renderStandings(){
  const all=[...fixtures,...knockoutFixtures];
  const stats={};
  teams.forEach(t=>stats[t.name]={pts:0,played:0,W:0,L:0,S:0,SC:0,SD:0});
  all.forEach(m=>{
    if(!m.winner||!m.score) return;
    let [s1,s2]=m.score;
    let t1=m.teams[0].name, t2=m.teams[1].name;
    stats[t1].played++; stats[t2].played++;
    if(m.winner===t1){ stats[t1].pts+=2; stats[t1].W++; stats[t2].L++; }
    else { stats[t2].pts+=2; stats[t2].W++; stats[t1].L++; }
    stats[t1].S+=s1; stats[t1].SC+=s2;
    stats[t2].S+=s2; stats[t2].SC+=s1;
  });
  Object.values(stats).forEach(s=>s.SD=s.S-s.SC);
  const sorted=Object.entries(stats).sort((a,b)=>{
    if(b[1].pts!==a[1].pts) return b[1].pts-a[1].pts;
    if(b[1].SD!==a[1].SD) return b[1].SD-a[1].SD;
    if(b[1].S!==a[1].S) return b[1].S-a[1].S;
    return b[1].SC-a[1].SC;
  });
  let html=`<table class="standings"><tr>
    <th>Team</th><th>Pl</th><th>W</th><th>L</th><th>Pts</th><th>S</th><th>SC</th><th>SD</th>
  </tr>`;
  sorted.forEach(([n,s])=>{
    html+=`<tr><td>${n}</td><td>${s.played}</td><td>${s.W}</td><td>${s.L}</td><td>${s.pts}</td><td>${s.S}</td><td>${s.SC}</td><td>${s.SD}</td></tr>`;
  });
  html+='</table>';
  document.getElementById('standingsTable').innerHTML=html;
}

/* League progression */
function checkLeagueCompletion(){
  if(phase!=="league") return;
  if(fixtures.every(m=>m.winner)){
    phase="knockout";
    generateKnockoutFixtures();
    renderFixtures();
    renderStandings();
    showBigAlert('Liiga valmis','Karsintapelit luotu',{autoCloseMs:3000});
  }
}

function generateKnockoutFixtures(){
  const stats={};
  teams.forEach(t=>stats[t.name]={pts:0,S:0,SC:0});
  fixtures.forEach(m=>{
    if(!m.winner||!m.score) return;
    let [s1,s2]=m.score;
    let t1=m.teams[0].name, t2=m.teams[1].name;
    if(m.winner===t1) stats[t1].pts+=2; else stats[t2].pts+=2;
    stats[t1].S+=s1; stats[t1].SC+=s2;
    stats[t2].S+=s2; stats[t2].SC+=s1;
  });
  const sorted=Object.entries(stats).sort((a,b)=>{
    if(b[1].pts!==a[1].pts) return b[1].pts-a[1].pts;
    if(b[1].S!==a[1].S) return b[1].S-a[1].S;
    return b[1].SC-a[1].SC;
  }).map(([n])=>n);
  let [t1,t2,t3,t4]=sorted;
  knockoutFixtures=[
    {id:'SF1',teams:[getTeamByName(t1),getTeamByName(t4)],phase:'knockout',cups:knockoutCups,winner:null,score:null,awaitingConfirm:false},
    {id:'SF2',teams:[getTeamByName(t2),getTeamByName(t3)],phase:'knockout',cups:knockoutCups,winner:null,score:null,awaitingConfirm:false},
  ];
}
function getTeamByName(n){ return teams.find(t=>t.name===n)||null; }

function checkKnockoutProgression(){
  if(knockoutFixtures.length===2 && knockoutFixtures.every(m=>m.winner)){
    let sf1=knockoutFixtures[0], sf2=knockoutFixtures[1];
    let finalists=[sf1.winner,sf2.winner];
    let bronzeTeams=[
      sf1.teams.find(t=>t.name!==sf1.winner).name,
      sf2.teams.find(t=>t.name!==sf2.winner).name
    ];
    knockoutFixtures.push({
      id:'Final',
      teams:[getTeamByName(finalists[0]),getTeamByName(finalists[1])],
      phase:'knockout',cups:knockoutCups,winner:null,score:null,awaitingConfirm:false
    });
    knockoutFixtures.push({
      id:'Bronze',
      teams:[getTeamByName(bronzeTeams[0]),getTeamByName(bronzeTeams[1])],
      phase:'knockout',cups:knockoutCups,winner:null,score:null,awaitingConfirm:false
    });
    renderFixtures();
    renderStandings();
    showBigAlert('Semifinaalit','Finaali + pronssi lisätty',{autoCloseMs:3000});
  }
  if(knockoutFixtures.length===4 && knockoutFixtures.slice(2).every(m=>m.winner)){
    let fin=knockoutFixtures.find(m=>m.id==='Final');
    let bronze=knockoutFixtures.find(m=>m.id==='Bronze');
    if(fin && bronze){
      showBigAlert('Turnaus valmis',
        `Mestari: ${fin.winner}\nHopea: ${fin.teams.find(t=>t.name!==fin.winner).name}\nPronssi: ${bronze.winner}`);
    }
  }
}

/* Test utilities */
function randomLoserScore(){
  const r=Math.random();
  if(r<0.03) return 1;
  if(r<0.1) return 2;
  if(r<0.45) return 3;
  if(r<0.8) return 4;
  return 5;
}
function applyTestResultToMatch(m,wIdx,wScore,lScore){
  if(!m?.teams?.length) return;
  m.winner=m.teams[wIdx].name;
  m.score=wIdx===0?[wScore,lScore]:[lScore,wScore];
  m.awaitingConfirm=false;
  m.time=undefined;
  const losingTeam=m.teams[wIdx===0?1:0];
  startLosersGame(losingTeam,()=>{
    ongoingMatchId=null;
    renderFixtures(); renderStandings(); checkLeagueCompletion(); if(phase==="knockout") checkKnockoutProgression();
  });
}
window.generateAllResults=function(){
  if(!testFeaturesEnabled) return;
  [...fixtures,...knockoutFixtures].forEach(m=>{
    if(m && !m.winner){
      const wIdx=Math.random()<0.5?0:1;
      applyTestResultToMatch(m,wIdx,6,randomLoserScore());
    }
  });
  showBigAlert('Testitulokset','Generoitu',{autoCloseMs:2500});
};
window.promptAndApplyResult=function(id){
  if(!testFeaturesEnabled) return;
  const m=getMatchById(id);
  if(!m) return;
  const inp=prompt('Syötä tulos esim 6-2','6-0');
  if(!inp) return;
  const parts=inp.split('-');
  if(parts.length!==2) return alert('Virheellinen muoto');
  const left=+parts[0], right=+parts[1];
  if(Number.isNaN(left)||Number.isNaN(right)||left===right) return alert('Virheellinen tulos');
  const wIdx= left>right?0:1;
  m.winner=m.teams[wIdx].name;
  m.score=[left,right];
  m.awaitingConfirm=false;
  ongoingMatchId=null;
  m.time=undefined;
  renderFixtures(); renderStandings(); checkLeagueCompletion(); if(phase==="knockout") checkKnockoutProgression();
  showBigAlert('Tallennettu',`${m.teams[0].name} ${left} - ${right} ${m.teams[1].name}`,{autoCloseMs:2200});
};

/* Add Viinaharava button after DOM loaded */
document.addEventListener('DOMContentLoaded', ()=>{
  const resetBtn=document.getElementById('resetBtn');
  if(resetBtn){
    const vb=document.createElement('button');
    vb.id='viinaharavaBtn';
    vb.className='btn';
    vb.textContent='Viinaharava';
    vb.disabled=!testFeaturesEnabled;
    vb.addEventListener('click',()=>{
      startLosersGame({name:"Joukkue 1", players:["Pelaaja 1","Pelaaja 2"]});
    });
    resetBtn.parentNode.insertBefore(vb, resetBtn.nextSibling);
  }
});

/* Expose some functions for minimal necessity */
window.beginTournament=beginTournament;

/* Done */
console.log(LOG_PREFIX,"Script loaded.");
</script>
</body>
</html>
